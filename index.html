<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    
    <style>
        /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        body {
            margin: 0;
            padding: 0;
            background-color: #0d1117; /* GitHub Darké¢¨ã®èƒŒæ™¯è‰² */
            color: #e6edf3;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
        header {
            padding: 0 24px;
            height: 60px;
            background-color: #010409;
            border-bottom: 1px solid #30363d;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        header h1 { 
            font-size: 1.1rem; 
            font-weight: 600; 
            color: #e6edf3; 
            display: flex; align-items: center; gap: 8px; margin: 0;
            /* é•·ã„ã‚¿ã‚¤ãƒˆãƒ«ã‚’çœç•¥è¡¨ç¤º */
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            max-width: 80%; 
        }
        header h1::before { content: 'ğŸ“‹'; font-size: 1.2rem; flex-shrink: 0; }
        header .status { 
            font-size: 0.8rem; color: #8b949e; 
            font-family: ui-monospace, SFMono-Regular, monospace; 
            white-space: nowrap; margin-left: 10px;
        }

        /* --- ãƒ¡ã‚¤ãƒ³ãƒœãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ --- */
        #board-canvas {
            flex-grow: 1;
            overflow-x: auto; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ‰åŠ¹ */
            overflow-y: hidden;
            display: flex;
            padding: 24px;
            gap: 24px;
            align-items: flex-start;
        }

        /* --- ã‚«ãƒ©ãƒ ï¼ˆåˆ—ï¼‰ --- */
        .column {
            background-color: #161b22;
            min-width: 350px;
            max-width: 350px;
            border-radius: 6px;
            border: 1px solid #30363d;
            display: flex;
            flex-direction: column;
            max-height: 100%;
            flex-shrink: 0;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .column-header {
            padding: 14px 18px;
            font-weight: 600;
            font-size: 0.95rem;
            border-bottom: 1px solid #21262d;
            color: #e6edf3;
            background-color: #161b22;
            border-radius: 6px 6px 0 0;
            flex-shrink: 0;
            position: sticky; top: 0; z-index: 10;
        }

        .column-body {
            padding: 12px;
            overflow-y: auto;
            display: flex; flex-direction: column; gap: 12px;
            /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
            scrollbar-width: thin;
            scrollbar-color: #30363d #161b22;
        }
        .column-body::-webkit-scrollbar { width: 8px; }
        .column-body::-webkit-scrollbar-track { background: #161b22; }
        .column-body::-webkit-scrollbar-thumb { background-color: #30363d; border-radius: 4px; }

        /* --- ã‚«ãƒ¼ãƒ‰ --- */
        .card {
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 16px;
            display: flex; flex-direction: column;
            position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: all 0.2s cubic-bezier(0.3, 0, 0.5, 1);
        }
        .card:hover {
            border-color: #8b949e;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
            z-index: 5;
        }

        /* ã‚«ãƒ¼ãƒ‰ã®è‰²è¨­å®š (å·¦å´ã®ãƒœãƒ¼ãƒ€ãƒ¼ã¨èƒŒæ™¯) */
        .card.color-white  { border-left: 3px solid #8b949e; }
        .card.color-red    { border-left: 3px solid #ff7b72; background: linear-gradient(180deg, rgba(255,123,114,0.1) 0%, rgba(13,17,23,0) 50%); }
        .card.color-yellow { border-left: 3px solid #d29922; background: linear-gradient(180deg, rgba(210,153,34,0.1) 0%, rgba(13,17,23,0) 50%); }
        .card.color-green  { border-left: 3px solid #3fb950; background: linear-gradient(180deg, rgba(63,185,80,0.1) 0%, rgba(13,17,23,0) 50%); }
        .card.color-blue   { border-left: 3px solid #58a6ff; background: linear-gradient(180deg, rgba(88,166,255,0.1) 0%, rgba(13,17,23,0) 50%); }
        .card.color-purple { border-left: 3px solid #bc8cff; background: linear-gradient(180deg, rgba(188,140,255,0.1) 0%, rgba(13,17,23,0) 50%); }

        /* ã‚«ãƒ¼ãƒ‰å†…ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .card-title {
            font-size: 1rem; font-weight: 600; margin-bottom: 6px;
            color: #58a6ff; line-height: 1.4;
        }
        .card-author {
            font-size: 0.75rem; color: #7d8590; margin-bottom: 12px;
            display: flex; align-items: center; gap: 6px;
        }
        .card-content {
            font-size: 0.85rem; line-height: 1.6; color: #c9d1d9;
            margin-bottom: 10px; overflow-wrap: break-word;
        }
        /* ç”»åƒã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        .card-content img { 
            max-width: 100%; height: auto; 
            border-radius: 4px; border: 1px solid #30363d; 
            margin-top: 8px; margin-bottom: 6px; display: block;
        }
        .card-content a { color: #58a6ff; text-decoration: none; }
        .card-content a:hover { text-decoration: underline; }

        /* æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒœã‚¿ãƒ³ */
        .attachment-link {
            display: inline-block;
            margin-top: 4px; margin-bottom: 12px;
            padding: 6px 12px;
            background-color: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #58a6ff !important;
            font-size: 0.8rem;
            text-decoration: none !important;
            transition: background 0.2s;
            font-weight: 600;
        }
        .attachment-link:hover {
            background-color: #30363d;
            color: #79c0ff !important;
            border-color: #8b949e;
        }

        /* ã‚³ãƒ¡ãƒ³ãƒˆã‚¨ãƒªã‚¢ */
        .comments-section {
            background-color: #161b22;
            border-radius: 6px;
            padding: 8px 12px;
            margin-top: 8px;
            border: 1px solid #30363d;
        }
        .comments-header {
            font-size: 0.75rem; font-weight: 600; color: #7d8590;
            margin-bottom: 8px; display: flex; justify-content: space-between;
        }
        .comments-list {
            max-height: 150px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 8px;
            scrollbar-width: thin;
        }
        .comment-item {
            font-size: 0.8rem; padding: 8px 0; border-bottom: 1px solid #21262d;
        }
        .comment-item:last-child { border-bottom: none; }
        .comment-top { display: flex; justify-content: space-between; margin-bottom: 2px; font-size: 0.75rem; }
        .comment-user { color: #e6edf3; font-weight: bold; }
        .comment-date { color: #7d8590; }
        .comment-msg { color: #c9d1d9; word-break: break-all; }

        /* ã‚«ãƒ¼ãƒ‰ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆã‚¹ã‚¿ãƒ¼è©•ä¾¡ãƒ»æ—¥ä»˜ï¼‰ */
        .card-footer {
            margin-top: auto; padding-top: 12px;
            border-top: 1px solid rgba(48, 54, 61, 0.5);
            display: flex; justify-content: space-between; align-items: center;
        }
        .stars {
            background: rgba(227, 179, 65, 0.1); color: #e3b341;
            padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; font-weight: 600;
        }
        .date-info { font-size: 0.7rem; color: #7d8590; }

        /* ãƒ­ãƒ¼ãƒ‰ç”»é¢ãƒ»ã‚¨ãƒ©ãƒ¼ç”»é¢ */
        #loading { width: 100%; height: 100%; display: flex; padding: 20px; gap: 20px; }
        .skeleton-column {
            min-width: 350px; height: 80%; background: #161b22;
            border-radius: 6px; border: 1px solid #30363d; padding: 15px;
            display: flex; flex-direction: column; gap: 15px;
        }
        .skeleton-card {
            width: 100%; height: 120px; background: #21262d;
            border-radius: 6px; position: relative; overflow: hidden;
        }
        .skeleton-card::after {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        #error-message {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #ff7b72; text-align: center; display: none;
        }

        /* ã‚¹ãƒãƒ›å¯¾å¿œ */
        @media (max-width: 768px) {
            .column { min-width: 85vw; scroll-snap-align: center; }
            #board-canvas { scroll-snap-type: x mandatory; padding: 16px; gap: 16px; }
            header h1 { font-size: 0.9rem; }
        }
    </style>
</head>
<body>

    <header>
        <h1>
            ãƒ—ãƒ­ã‚­ã‚·ã®ãƒªãƒ³ã‚¯ã‚„YouTubeã®é–²è¦§æ–¹æ³•ã‚’å…±æœ‰ã™ã‚‹ä¼š
            <img src="https://count.getloli.com/@toka_kun_?name=toka_kun_&theme=original-new&padding=7&offset=0&align=top&scale=0.4&pixelated=1&darkmode=1&_=0.48102400290076575" alt="count" style="margin-left:8px; vertical-align:middle;">
        </h1>
        <div class="status" id="last-update">èª­ã¿è¾¼ã¿ä¸­...</div>
    </header>

    <main id="board-canvas">
        <div id="loading">
            <div class="skeleton-column">
                <div class="skeleton-card" style="height:40px; margin-bottom:10px;"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
            </div>
            <div class="skeleton-column">
                <div class="skeleton-card" style="height:40px; margin-bottom:10px;"></div>
                <div class="skeleton-card"></div>
            </div>
        </div>
        <div id="error-message"></div>
    </main>

    <script>
        const markdownUrl = '/padlet_export.txt';

        // --- Marked(Markdownãƒ‘ãƒ¼ã‚µãƒ¼)ã®è¨­å®š ---
        const renderer = new marked.Renderer();
        renderer.link = function(href, title, text) {
            // ãƒªãƒ³ã‚¯ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã‚ˆã†ã«å¼·åˆ¶
            return `<a href="${href}" target="_blank" rel="noopener noreferrer">${text}</a>`;
        };
        marked.setOptions({ renderer: renderer, breaks: true });

        // --- ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨åˆæœŸåŒ– ---
        async function fetchAndRender() {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error-message');
            const updateDiv = document.getElementById('last-update');
            const canvas = document.getElementById('board-canvas');

            try {
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ä¸
                const response = await fetch(`${markdownUrl}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                
                loadingDiv.remove();
                const now = new Date();
                updateDiv.textContent = 'æœ€çµ‚æ›´æ–°: ' + now.toLocaleTimeString('ja-JP');

                renderBoard(text, canvas);

            } catch (error) {
                console.error('Fetch error:', error);
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `
                    <h3>èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</h3><p>${escapeHtml(error.message)}</p>
                    <button onclick="location.reload()" style="margin-top:10px; padding:6px 12px; cursor:pointer; background:#21262d; color:#e6edf3; border:1px solid #30363d; border-radius:4px;">å†èª­ã¿è¾¼ã¿</button>
                `;
                updateDiv.textContent = 'ã‚¨ãƒ©ãƒ¼';
            }
        }

        // --- ãƒœãƒ¼ãƒ‰ã®æç”»å‡¦ç† ---
        function renderBoard(markdownText, canvas) {
            // "## " ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåˆ—ï¼‰ã”ã¨ã«åˆ†å‰²
            const columns = markdownText.split(/^## /gm);
            
            columns.forEach((colText, index) => {
                if (colText.trim().length === 0) return;

                const firstLineBreak = colText.indexOf('\n');
                let colTitle = (firstLineBreak === -1) ? colText.trim() : colText.substring(0, firstLineBreak).trim();
                let colContent = (firstLineBreak === -1) ? '' : colText.substring(firstLineBreak + 1);

                // Summaryå¯¾å¿œï¼šH1ç›´ä¸‹ã®èª¬æ˜æ–‡ãªã©ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®å‡¦ç†
                if (index === 0 && colTitle.startsWith('# ')) {
                     if (!colContent.trim()) return;
                }

                // ã‚«ãƒ©ãƒ ã®HTMLç”Ÿæˆ
                const colDiv = document.createElement('div');
                colDiv.className = 'column';
                colDiv.innerHTML = `
                    <div class="column-header">${escapeHtml(colTitle)}</div>
                    <div class="column-body"></div>
                `;
                const colBody = colDiv.querySelector('.column-body');

                // ã‚«ãƒ¼ãƒ‰åˆ†å‰² (###)
                let cardsData = colContent.split(/^### /gm);

                // Summaryã‚„å†’é ­èª¬æ˜ãªã©ã€"###" ãŒãªã„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å‡¦ç†
                if (cardsData.length === 1 && !colContent.includes('### ')) {
                    const content = cardsData[0].trim();
                    if (content) {
                        // ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦ã€Œæ¦‚è¦ã€ãªã©ã‚’ä»˜ä¸ã—ã¦ã‚«ãƒ¼ãƒ‰åŒ–
                        cardsData = [`${colTitle} æ¦‚è¦\n${content}`];
                    } else {
                        cardsData = [];
                    }
                }

                cardsData.forEach((cardText, cIndex) => {
                    if (!cardText.trim()) return;

                    try {
                        const card = parseCard(cardText);
                        colBody.appendChild(createCardElement(card));
                    } catch (e) {
                        console.warn('Card parse error:', e);
                    }
                });

                if (colBody.children.length > 0) {
                    canvas.appendChild(colDiv);
                }
            });
        }

        // --- ãƒ†ã‚­ã‚¹ãƒˆè§£æï¼ˆè‹±èªãƒ»æ—¥æœ¬èªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰ ---
        function parseCard(text) {
            const lines = text.trim().split('\n');
            const title = lines[0].trim(); 
            
            // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºé–¢æ•°ï¼ˆæ­£è¦è¡¨ç¾, å¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–ï¼‰
            const getMeta = (regex) => {
                const match = text.match(regex);
                return match ? match[1].trim() : null;
            };

            // Author, Builder, ä½œæˆè€…ã«å¯¾å¿œ
            const author = getMeta(/\*\*(?:Author|ä½œæˆè€…|Builder):\*\* (.*)/i) || 'ä¸æ˜';
            
            // Post color, Color, æŠ•ç¨¿ã®ã‚«ãƒ©ãƒ¼ã«å¯¾å¿œ
            const color = getMeta(/\*\*(?:Post color|Color|æŠ•ç¨¿ã®ã‚«ãƒ©ãƒ¼):\*\* (.*)/i) || 'White';
            
            // æ—¥ä»˜ (Created At, Updated At)
            let dateStr = getMeta(/\*\*(?:Created At \(UTC\)|Created At|ä½œæˆæ—¥\(UTC\)|ä½œæˆæ—¥):\*\* (.*)/i);
            if (!dateStr) dateStr = getMeta(/\*\*(?:Updated At \(UTC\)|Updated At|æœ€çµ‚æ›´æ–°æ—¥):\*\* (.*)/i);

            // è©•ä¾¡ (Stars)
            const rating = parseFloat(getMeta(/\*\*(?:Average star rating|æ˜Ÿè©•ä¾¡å¹³å‡):\*\* ([\d\.]+)/i) || 0);
            const ratingCount = getMeta(/\*\*(?:Number of ratings|è©•ä¾¡ä»¶æ•°|Votes):\*\* (\d+)/i) || 0;

            // ã‚³ãƒ¡ãƒ³ãƒˆæŠ½å‡º
            let comments = [];
            const commentBlockRegex = /#### (?:Comments|ã‚³ãƒ¡ãƒ³ãƒˆ)[^\n]*\n([\s\S]*?)(?=####|$)/i;
            const commentMatch = text.match(commentBlockRegex);
            if (commentMatch) {
                const commentLines = commentMatch[1].trim().split('\n');
                commentLines.forEach(line => {
                    const m = line.match(/- \*\*(.*?)\*\* \((.*?)\): (.*)/);
                    if (m) comments.push({ user: m[1], date: m[2], msg: m[3] });
                });
            }

            // æœ¬æ–‡ã®æ•´å½¢ï¼ˆã‚¿ã‚¤ãƒˆãƒ«è¡Œã®å‰Šé™¤ï¼‰
            let content = text;
            if (lines.length > 0) content = lines.slice(1).join('\n'); 

            // æœ¬æ–‡ã‹ã‚‰å‰Šé™¤ã™ã‚‹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡Œï¼ˆç®‡æ¡æ›¸ããƒã‚¤ãƒ•ãƒ³æœ‰ç„¡ä¸¡å¯¾å¿œï¼‰
            const patternsToRemove = [
                /(?:- )?\*\*(?:Author|ä½œæˆè€…|Builder):.*[\r\n]+/gi,
                /(?:- )?\*\*(?:Post color|Color|æŠ•ç¨¿ã®ã‚«ãƒ©ãƒ¼):.*[\r\n]+/gi,
                /(?:- )?\*\*(?:Created At|ä½œæˆæ—¥).*?:.*[\r\n]+/gi,
                /(?:- )?\*\*(?:Updated At|æœ€çµ‚æ›´æ–°æ—¥).*?:.*[\r\n]+/gi,
                /(?:- )?\*\*(?:Average star rating|æ˜Ÿè©•ä¾¡å¹³å‡):.*[\r\n]+/gi,
                /(?:- )?\*\*(?:Number of ratings|è©•ä¾¡ä»¶æ•°):.*[\r\n]+/gi,
                /(?:- )?\*\*(?:Link|Posts):.*[\r\n]+/gi, // Summaryç”¨
                /#### (?:Comments|ã‚³ãƒ¡ãƒ³ãƒˆ)[\s\S]*?(?=####|$)/i, 
                /#### (?:Reactions|ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³)[\s\S]*?(?=####|$)/i, 
                /#### (?:Additional Information|ãã®ä»–ã®æƒ…å ±)[\s\S]*?(?=####|$)/i, 
                /^---[\r\n]+/gm 
            ];
            patternsToRemove.forEach(regex => content = content.replace(regex, ''));
            
            // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ï¼š [Attachment](url) ã‚’ ç”»åƒè¡¨ç¤º + æ—¥æœ¬èªãƒœã‚¿ãƒ³ ã«å¤‰æ›
            content = content.replace(/!?\[(?:Attachment|æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«)\]\((.*?)\)/gi, (match, url) => {
                return `![](${url})\n<a href="${url}" target="_blank" class="attachment-link">ğŸ“ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã</a>`;
            });

            return {
                title: title,
                author: author,
                color: color,
                content: content.trim(),
                comments: comments,
                rating: rating,
                ratingCount: ratingCount,
                date: dateStr || ''
            };
        }

        // --- ã‚«ãƒ¼ãƒ‰DOMç”Ÿæˆ ---
        function createCardElement(data) {
            const el = document.createElement('div');
            
            // è‰²åˆ¤å®š (è‹±èªãƒ»æ—¥æœ¬èªãƒ»å°æ–‡å­— å¯¾å¿œ)
            let colorClass = 'color-white';
            if (data.color) {
                const c = data.color.toLowerCase();
                if (c.includes('red') || c.includes('ãƒ¬ãƒƒãƒ‰')) colorClass = 'color-red';
                else if (c.includes('yellow') || c.includes('ã‚¤ã‚¨ãƒ­ãƒ¼')) colorClass = 'color-yellow';
                else if (c.includes('green') || c.includes('ã‚°ãƒªãƒ¼ãƒ³')) colorClass = 'color-green';
                else if (c.includes('blue') || c.includes('ãƒ–ãƒ«ãƒ¼')) colorClass = 'color-blue';
                else if (c.includes('purple') || c.includes('ãƒ‘ãƒ¼ãƒ—ãƒ«')) colorClass = 'color-purple';
            }
            el.className = `card ${colorClass}`;

            // ã‚¹ã‚¿ãƒ¼è¡¨ç¤º
            const starsStr = data.rating > 0 ? 'â­'.repeat(Math.round(data.rating)) : '';
            const ratingText = data.ratingCount > 0 ? `(${data.ratingCount})` : '';

            // ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ç”Ÿæˆ
            let commentsHtml = '';
            if (data.comments.length > 0) {
                const list = data.comments.map(c => `
                    <div class="comment-item">
                        <div class="comment-top">
                            <span class="comment-user">${escapeHtml(c.user)}</span>
                            <span class="comment-date">${escapeHtml(c.date)}</span>
                        </div>
                        <span class="comment-msg">${escapeHtml(c.msg)}</span>
                    </div>
                `).join('');
                commentsHtml = `
                    <div class="comments-section">
                        <div class="comments-header">
                            <span>ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ</span>
                            <span>${data.comments.length}</span>
                        </div>
                        <div class="comments-list">${list}</div>
                    </div>
                `;
            }

            // HTMLå¤‰æ›ï¼ˆMarkdown -> HTMLï¼‰ & ã‚µãƒ‹ã‚¿ã‚¤ã‚º
            const rawHtml = marked.parse(data.content);
            const cleanHtml = DOMPurify.sanitize(rawHtml, { ADD_ATTR: ['target', 'class'] });

            el.innerHTML = `
                <div class="card-title">${escapeHtml(data.title)}</div>
                <div class="card-author">ğŸ‘¤ ${escapeHtml(data.author)}</div>
                <div class="card-content markdown-body" style="background:transparent; color:#c9d1d9;">
                    ${cleanHtml}
                </div>
                ${commentsHtml}
                <div class="card-footer">
                    <span class="stars">${starsStr} <span style="color:#8b949e;font-weight:normal;font-size:0.75rem;">${ratingText}</span></span>
                    <span class="date-info">${escapeHtml(data.date)}</span>
                </div>
            `;
            return el;
        }

        // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ï¼ˆXSSå¯¾ç­–ï¼‰
        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        // å®Ÿè¡Œé–‹å§‹
        fetchAndRender();
    </script>
</body>
</html>
